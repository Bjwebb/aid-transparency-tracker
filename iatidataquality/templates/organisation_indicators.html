{% set active_page='organisations'%}{% extends "layout.html" %}
{% block title %}{{organisation.organisation_name}} &raquo; Organisations{% endblock %}
{% block content %}

   <script src="/static/jquery.tablesorter.min.js"></script>
    <script >
    $(function() {
    $("table#results").tablesorter({ sortList: [[0,0]] });
    });

    </script>

    <h1><a href="{{url_for('organisations', organisation_code=organisation.organisation_code)}}">{{organisation.organisation_name}}</a><code>{{organisation.organisation_code}}</code></h1>
    <div class="pull-right">
        <p><form action="" method="GET" id="aggregation_type_form"><a href="{{url_for('organisation_publication_detail', organisation_code=organisation.organisation_code)}}" class="btn">Detail</a> 
            <select name="aggregation_type" id="aggregation_type">
                {% for agt in all_aggregation_types %}
                <option value="{{agt.AggregationType.id}}"{% if agt.AggregationType.id==aggregation_type %} selected{%endif%}>{{agt.AggregationType.name}}</option>
                {% endfor %}
            </select>
        </form></p>
    </div>

    {% if results %}

    <h3>2013 Index &raquo; Publication</h3>
    <div class="alert alert-info">
        <h4>An initial assessment of your publication is below.</h4>
        <p>IATI data and non-IATI data is scored in the Index, but IATI data is scored higher. <a class="btn btn-mini">Learn more &raquo;</a></p>
        <p><b>For indicators published to IATI:</b></p>
        <ul>
            <li>Where a test doesn't appear to be capturing information that is published in your data, please let us know.</li>
            <li>Where there are problems in your data, please try and correct them.</li>
        </ul>
        <p><b>For indicators not published to IATI:</b></p>
        <ul>
            <li>Check our initial assessment of the information we found on your website.</li>
            <li>You only need to do this if you aren't publishing that indiciator to IATI.</li>
            <li>You can do this by clicking <a class="btn btn-mini">Edit</a> alongside each indicator, or by clicking <a class="btn btn-mini">Review manually collected data</a>.</li>
        </ul>
    </div>
    <div class="alert alert-danger">
        <h4>How do you structure your data?</h4>
        <p>We found multiple hierarchies (e.g. programs and projects) in your data. You haven't told us yet about how you structure your data, and this could make a significant difference to your IATI score.</p>
        <p><a href="{{url_for('organisations_feedback', organisation_code=organisation.organisation_code)}}" class="btn btn-danger">Provide structure &raquo;</a></p>
    </div>
        <fieldset>
        <h3>Published to IATI</h3>
        <p class="lead">Each indicator published to IATI scores a maximum of 100 points</p>
        <table class="table" id="results">
        <thead>
        <th>Indicator</th>
        <th><span class="th_test hidden">Test</span></th>
        <th>% Passed</th>
        <th><span class="th_test hidden">Total results</span></th>
        <th>Detail</th>
        </thead>
        <tbody>
        {% for indicator, result in results.non_zero.items() %}
            <tr id="indicator-{{result["indicator"]["id"]}}">
            <td><a href="#indicator{{result["indicator"]["id"]}}" role="button" data-toggle="modal">{{result["indicator"]["description"]}}</a>
                <div id="indicator{{result["indicator"]["id"]}}" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="indicatorHeader" aria-hidden="true">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                        <h3 id="indicatorHeader">Indicator: {{result["indicator"]["description"]}}</h3>
                    </div>
                    <div class="modal-body">
                        Description of the indicator goes here. <a href="{{url_for('indicatortests', indicatorgroup='pwyf123', indicator=result["indicator"]["name"])}}">Details &raquo;</a>
                    </div>
                    <div class="modal-footer">
                        <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
                    </div>
                </div>
            </td>
	        <td></td>
            <td class="pct">{{result.results_pct|round|int}}</td>
            <td></td>
            <td><a href="#" class="showTests" id="showindicator-{{result["indicator"]["id"]}}"><i class="icon-chevron-down"></i></a></td>
            </tr>

            {% for testdata in result["tests"] %}
            <tr id="tr{{testdata["test"]["id"]}}" class="group-{{result["indicator"]["id"]}} hidden">
            <td><span class="hidden">{{result["indicator"]["description"]}}.</span></td>
	        <td><a href="{{url_for('tests', id=testdata["test"]["id"])}}">{{ testdata["test"]["description"] }}</a>{% if testdata["condition"] %} <i class="icon-info-sign" title="{{testdata["condition"]}}"></i>{%endif%}</td>
            <td class="pct">{{testdata.results_pct|round|int}}</td>
            <td>{{testdata["results_num"]|round|int}}</td>
            <td></td>
            </tr>
            {% endfor %}
        {%endfor%}
        </tbody>
        </table>
        </fieldset>

        <fieldset>
        <h3>Not published to IATI</h3>
        <p class="lead">Each indicator not published to IATI, but published elsewhere (e.g. on your website) scores a maximum of 50 points</p>
        <h4>Scoring criteria</h4>
        <p>For each indicator, points are received if that indicator is <label class="label label-success">Always published</label>. The points received depend on the format the information is available in.</p>
        <ul>
            <li>10 points: PDF file</li>
            <li>30 points: Website</li>
            <li>50 points: CSV, Excel, XML, or other structured, machine-readable format</li>
        </ul>
        <p>If published, documents receive the full 50 points, since it would not make sense for the information to be provided in a structured format.</p>
            
        <div class="alert alert-info">
            <h4>Why is IATI data scored more highly?</h4>
            <p>IATI is the only standard for publishing comparable, timely and easily re-usable data, which are critical components of aid transparency.</p>
            <p><a class="btn btn-info">Learn more &raquo;</a></p>
        </div>
        <table class="table" id="results">
        <thead>
        <th>Indicator</th>
        <th><span class="th_test hidden">Test</span></th>
        <th>IATI data</th>
        <th>Published</th>
        <th>Format</th>
        <th>Score</th>
        <th>Detail</th>
        </thead>
        <tbody>
        {% for indicator, result in results.zero.items() %}
            <tr id="indicator-{{result["indicator"]["id"]}}">
            <td><a href="#indicator{{result["indicator"]["id"]}}" role="button" data-toggle="modal">{{result["indicator"]["description"]}}</a>
                <div id="indicator{{result["indicator"]["id"]}}" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="indicatorHeader" aria-hidden="true">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                        <h3 id="indicatorHeader">Indicator: {{result["indicator"]["description"]}}</h3>
                    </div>
                    <div class="modal-body">
                        Description of the indicator goes here. <a href="{{url_for('indicatortests', indicatorgroup='pwyf123', indicator=result["indicator"]["name"])}}">Details &raquo;</a>
                    </div>
                    <div class="modal-footer">
                        <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
                    </div>
                </div>
            </td>
	        <td></td>
            <td><span class="label label-inverse">NOT FOUND</span></td>
            {% set surveydata = true %}
            {% if surveydata %}
            <td><span class="label label-success">Always published</span> <a class="btn btn-mini">Edit &raquo;</a></td>
            <td>Website</td>
            <td>50</td>
            {% else %}
            <td colspan="3">
            <b>No survey data yet.</b>
            </td>
            {% endif %}
            <td><a href="#" class="showTests" id="showindicator-{{result["indicator"]["id"]}}"><i class="icon-chevron-down"></i></a></td>
            </tr>
            
            {% for testdata in result["tests"] %}
            <tr id="tr{{testdata["test"]["id"]}}" class="group-{{result["indicator"]["id"]}} hidden">
            <td><span class="hidden">{{result["indicator"]["description"]}}.</span></td>
	        <td><a href="{{url_for('tests', id=testdata["test"]["id"])}}">{{ testdata["test"]["description"] }}</a>{% if testdata["condition"] %} <i class="icon-info-sign" title="{{testdata["condition"]}}"></i>{%endif%}</td>
            <td class="pct">{{testdata.results_pct|round|int}}</td>
            <td>{{testdata["results_num"]|round|int}}</td>
            <td></td>
            <td></td>
            <td></td>
            </tr>
            {% endfor %}
        {%endfor%}
        </tbody>
        </table>
        </fieldset>
    {%endif%}

<script type="text/javascript">

    $(".showTests").click(function(e){
        if ($(this).hasClass("visible")) {
            e.preventDefault();

            re=new RegExp("showindicator-([0-9]*)");
            r=re.exec(this.id);
            indicator_id = r[1]

            $(this).closest("tr").removeClass("success");
            $(this).removeClass("visible").html('<i class="icon-chevron-down"></i>');
            $(".group-"+indicator_id).hide();
            $(".th_test").addClass('hidden');

        } else {
            e.preventDefault();

            re=new RegExp("showindicator-([0-9]*)");
            r=re.exec(this.id);
            indicator_id = r[1]
            $(this).closest("tr").addClass("success");
            $(this).addClass("visible").html('<i class="icon-chevron-up"></i>');
            $(".group-"+indicator_id).show().removeClass('hidden');
            $(".th_test").removeClass('hidden');
    }
    });
    $('#aggregation_type').change(function(){
        $('#aggregation_type_form').submit();
    });

</script>

{% endblock %}

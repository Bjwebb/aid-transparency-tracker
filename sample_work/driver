#!/usr/bin/env python

import sys
import json

from sample_work import SampleOrgTest, DocumentLinks, \
    WorkItems, TestInfo, NoMatchingTest, organisation_ids
import db
import os

import test_mapping

def all_test_ids():
    for k in test_mapping.test_to_kind.keys():
        try:
            t = TestInfo(k)
            yield t.test_id
        except NoMatchingTest:
            continue

def all_org_ids():
    for o in organisation_ids():
        yield o[0]

def run():
    org_ids = [ i for i in all_org_ids() ]
    test_ids = [ i for i in all_test_ids() ]

    #oo = [o for o in WorkItems(org_ids, test_ids)]
    #print json.dumps(oo, indent=2)


    filename = db.default_filename()
    db.make_db(filename, WorkItems(org_ids, test_ids))

if __name__ == '__main__':
    run()    

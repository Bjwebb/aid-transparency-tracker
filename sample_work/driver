#!/usr/bin/env python

from optparse import OptionParser

from sample_work import db, TestInfo, organisation_ids, test_mapping


def all_test_ids():
    test_ids = []
    for k in test_mapping.test_to_kind.keys():
        t = TestInfo(k)
        test_ids.append(t.test_id)
    return test_ids


def run(filename, org_ids, test_ids, create):
    print("test ids: {}".format(test_ids))
    db.make_db(filename, org_ids, test_ids, create)


if __name__ == '__main__':
    default_filename = db.default_filename()
    org_ids = organisation_ids()
    test_ids = all_test_ids()

    parser = OptionParser()
    parser.add_option("--filename", dest="filename", action="store",
                      default=default_filename)
    parser.add_option("--org-ids", dest="org_ids", action="store")
    parser.add_option("--test-ids", dest="test_ids", action="store")
    parser.add_option("--update", dest="update", action="store_true",
                      default=False)

    options, rest = parser.parse_args()

    if options.org_ids:
        org_ids = map(int, options.org_ids.split(","))
    if options.test_ids:
        test_ids = map(int, options.test_ids.split(","))
    create = not options.update

    run(options.filename, org_ids, test_ids, create)
